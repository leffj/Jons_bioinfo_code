dataRC_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_unite75_wTax_485_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
dataRC = read.table(file=dataRC_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# try taking out african/australian sites
#map.bySite = map.bySite[!map.bySite$continent %in% c('Africa','Australia'),]
# match up the data.
samplesToUse = intersect(intersect(row.names(data),row.names(dataRC)),map.bySite$site_code)
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
dataRC.use = dataRC[match(samplesToUse,row.names(dataRC)),match(samplesToUse,names(dataRC))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
#mantel
data.dm = as.dist(data.use)
dataRC.dm = as.dist(dataRC.use)
plot(data.dm,dataRC.dm)
mantel(data.dm,dataRC.dm,method='spearman')
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_unite75_wTax_485_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
dataP_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/raup-crick_max_cover_genus_matrix_controls_avg_by_site_code.txt'
dataP = read.table(file=dataP_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
samplesToUse = intersect(intersect(row.names(data),row.names(dataP)),map.bySite$site_code)
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
dataP.use = dataP[match(samplesToUse,row.names(dataP)),match(samplesToUse,names(dataP))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make dm
data.use.dm = as.dist(data.use)
dataP.use.dm = as.dist(dataP.use)
# test relationships
data.mds = metaMDS(data.use.dm)
dataP.mds = metaMDS(dataP.use.dm)
protest(data.mds,dataP.mds)
procr = procrustes(data.mds,dataP.mds)
summary(procr)
plot(procr,main='w/Bacteria')
plot(data.use.dm,dataP.use.dm,pch=19,xlab='Bacterial community comp. dissimilarity',
ylab='Plant community comp. dissimilarity')
m = lm(dataP.use.dm~data.use.dm)
abline(m,lwd=4,col='blue')
#mantel(data.use.dm,dataP.use.dm,method="pearson")
mantel(data.use.dm,dataP.use.dm,method="spearman")
dmat.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/raup-crick_otu_table_k__Bacteria_18000_controls.txt'
out.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/raup-crick_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
map.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_sampling_year_noNN10.txt'
cat = "site_code"
fun = 'mean'
# import
dmat = read.table(dmat.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
map = read.table(map.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
# convert dmat to 3 column format
dmat.clmns = data.frame(t(combn(unlist(labels(dmat)[1]),2)),as.numeric(as.dist(dmat)))
names(dmat.clmns) = c('x1','x2','dist')
# list x1 and x2 categories in new clmns
cat1 = map[match(dmat.clmns$x1,row.names(map)),cat]
cat2 = map[match(dmat.clmns$x2,row.names(map)),cat]
dmat.clmns = cbind(dmat.clmns,cat1,cat2)
# only take samples in mapping file
dmat.clmns = dmat.clmns[!is.na(dmat.clmns$cat1) & !is.na(dmat.clmns$cat2),]
# retain rows where distances are comparing samples from the same cat
dmat = read.table(dmat.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
dmat.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Bacteria_18000_controls.txt'
out.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
map.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_sampling_year_noNN10.txt'
cat = "site_code"
fun = 'mean'
# import
dmat = read.table(dmat.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
map = read.table(map.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
# convert dmat to 3 column format
dmat.clmns = data.frame(t(combn(unlist(labels(dmat)[1]),2)),as.numeric(as.dist(dmat)))
names(dmat.clmns) = c('x1','x2','dist')
# list x1 and x2 categories in new clmns
cat1 = map[match(dmat.clmns$x1,row.names(map)),cat]
cat2 = map[match(dmat.clmns$x2,row.names(map)),cat]
dmat = read.table(dmat.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
dmat.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Bacteria_18000.txt'
out.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
map.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_sampling_year_noNN10.txt'
cat = "site_code"
fun = 'mean'
# import
dmat = read.table(dmat.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
map = read.table(map.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
# convert dmat to 3 column format
dmat.clmns = data.frame(t(combn(unlist(labels(dmat)[1]),2)),as.numeric(as.dist(dmat)))
names(dmat.clmns) = c('x1','x2','dist')
# list x1 and x2 categories in new clmns
cat1 = map[match(dmat.clmns$x1,row.names(map)),cat]
cat2 = map[match(dmat.clmns$x2,row.names(map)),cat]
dmat.clmns = cbind(dmat.clmns,cat1,cat2)
# only take samples in mapping file
dmat.clmns = dmat.clmns[!is.na(dmat.clmns$cat1) & !is.na(dmat.clmns$cat2),]
# retain rows where distances are comparing samples from the same cat
dmat.clmns.reduced = dmat.clmns[dmat.clmns$cat1 != dmat.clmns$cat2,]
# combine cat columns to form comparison categories
# however, need to realize 'cat1__cat2' is equal to 'cat2__cat1'
# make df with every unique combination of cat levels
uniqueLevels = levels(factor(c(as.character(dmat.clmns.reduced$cat1),as.character(dmat.clmns.reduced$cat2))))
categories = data.frame(t(combn(uniqueLevels,2)))
# make a vector with each combination (first,second and second,first) for each combination
categorieslookup = paste(categories[,1],categories[,2])
categorieslookup = c(categorieslookup,paste(categories[,2],categories[,1]))
# make a vector with an index number for each combination of cat levels that associates with lookup vec
catIndex = c(seq.int(1,nrow(categories)),seq.int(1,nrow(categories)))
# now match the category combination (cat1 + cat2) in the dataset to the combination in
#    the lookup vec and pull the category index
joinedCats = paste(dmat.clmns.reduced$cat1,dmat.clmns.reduced$cat2)
distCats = catIndex[match(joinedCats,categorieslookup)]
dmat.clmns.reduced = cbind(dmat.clmns.reduced,distCats)
# get measure of center for each distance category
byCatDists = tapply(dmat.clmns.reduced$dist,INDEX=dmat.clmns.reduced$distCats,FUN=fun)
byCatDists.clms = cbind(as.character(categories[,1]),as.character(categories[,2]),as.vector(byCatDists))
row.names(byCatDists.clms) = NULL
# convert 3 column distances back to matrix format
uNames = as.character(uniqueLevels)
byCatDists.dmat = data.frame(matrix(ncol=length(uNames),nrow=length(uNames)))
names(byCatDists.dmat) = uNames
row.names(byCatDists.dmat) = uNames
for(i in 1:nrow(byCatDists.clms)){
byCatDists.dmat[byCatDists.clms[i,1],byCatDists.clms[i,2]] = as.character(byCatDists.clms[i,3])
}
for(i in 1:nrow(byCatDists.dmat)){
for(k in 1:ncol(byCatDists.dmat)){
if(is.na(byCatDists.dmat[i,k])){
byCatDists.dmat[i,k] = byCatDists.dmat[k,i]
}
}
}
byCatDists.dmat[is.na(byCatDists.dmat)] = 0
# write output matrix
write.table(byCatDists.dmat,file=out.f,sep='\t',row.names=TRUE,col.names=NA)
dmat.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Archaea_100.txt'
out.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Archaea_100_controls_avgSiteCode.txt'
map.f = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_sampling_year_noNN10.txt'
cat = "site_code"
fun = 'mean'
# import
dmat = read.table(dmat.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
map = read.table(map.f,header=TRUE,row.names=1,sep='\t',check.names=FALSE,comment.char="")
# convert dmat to 3 column format
dmat.clmns = data.frame(t(combn(unlist(labels(dmat)[1]),2)),as.numeric(as.dist(dmat)))
names(dmat.clmns) = c('x1','x2','dist')
# list x1 and x2 categories in new clmns
cat1 = map[match(dmat.clmns$x1,row.names(map)),cat]
cat2 = map[match(dmat.clmns$x2,row.names(map)),cat]
dmat.clmns = cbind(dmat.clmns,cat1,cat2)
# only take samples in mapping file
dmat.clmns = dmat.clmns[!is.na(dmat.clmns$cat1) & !is.na(dmat.clmns$cat2),]
# retain rows where distances are comparing samples from the same cat
dmat.clmns.reduced = dmat.clmns[dmat.clmns$cat1 != dmat.clmns$cat2,]
# combine cat columns to form comparison categories
# however, need to realize 'cat1__cat2' is equal to 'cat2__cat1'
# make df with every unique combination of cat levels
uniqueLevels = levels(factor(c(as.character(dmat.clmns.reduced$cat1),as.character(dmat.clmns.reduced$cat2))))
categories = data.frame(t(combn(uniqueLevels,2)))
# make a vector with each combination (first,second and second,first) for each combination
categorieslookup = paste(categories[,1],categories[,2])
categorieslookup = c(categorieslookup,paste(categories[,2],categories[,1]))
# make a vector with an index number for each combination of cat levels that associates with lookup vec
catIndex = c(seq.int(1,nrow(categories)),seq.int(1,nrow(categories)))
# now match the category combination (cat1 + cat2) in the dataset to the combination in
#    the lookup vec and pull the category index
joinedCats = paste(dmat.clmns.reduced$cat1,dmat.clmns.reduced$cat2)
distCats = catIndex[match(joinedCats,categorieslookup)]
dmat.clmns.reduced = cbind(dmat.clmns.reduced,distCats)
# get measure of center for each distance category
byCatDists = tapply(dmat.clmns.reduced$dist,INDEX=dmat.clmns.reduced$distCats,FUN=fun)
byCatDists.clms = cbind(as.character(categories[,1]),as.character(categories[,2]),as.vector(byCatDists))
row.names(byCatDists.clms) = NULL
# convert 3 column distances back to matrix format
uNames = as.character(uniqueLevels)
byCatDists.dmat = data.frame(matrix(ncol=length(uNames),nrow=length(uNames)))
names(byCatDists.dmat) = uNames
row.names(byCatDists.dmat) = uNames
for(i in 1:nrow(byCatDists.clms)){
byCatDists.dmat[byCatDists.clms[i,1],byCatDists.clms[i,2]] = as.character(byCatDists.clms[i,3])
}
for(i in 1:nrow(byCatDists.dmat)){
for(k in 1:ncol(byCatDists.dmat)){
if(is.na(byCatDists.dmat[i,k])){
byCatDists.dmat[i,k] = byCatDists.dmat[k,i]
}
}
}
byCatDists.dmat[is.na(byCatDists.dmat)] = 0
# write output matrix
write.table(byCatDists.dmat,file=out.f,sep='\t',row.names=TRUE,col.names=NA)
map_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_updated_noNN10.csv'
map = read.csv(file=map_fp,header=T,row.names=1,check.names=F)
map.bySite = ddply(map,.(site_code,continent),summarize,lnlive_mass=log(mean(live_mass)+1),
total_mass=log(mean(total_mass)+1),MAP=mean(MAP),MAT=mean(MAT),
MAP_VAR=mean(MAP_VAR),TEMP_VAR=mean(TEMP_VAR),lnsoil_pctN=log(mean(soil_pctN,na.rm=T)+1),
lnsoil_ppmP=log(mean(soil_ppmP,na.rm=T)+1),soil_pH=mean(soil_pH,na.rm=T),
PercentSand=mean(PercentSand,na.rm=T))
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
dataRC_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
mctype='Bacterial'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
dataRC = read.table(file=dataRC_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
samplesToUse = intersect(intersect(row.names(data),row.names(dataRC)),map.bySite$site_code)
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
dataRC.use = dataRC[match(samplesToUse,row.names(dataRC)),match(samplesToUse,names(dataRC))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
#mantel
data.dm = as.dist(data.use)
dataRC.dm = as.dist(dataRC.use)
plot(data.dm,dataRC.dm)
mantel(data.dm,dataRC.dm,method='spearman')
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Archaea_100_controls_avgSiteCode.txt'
dataRC_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/beta-Raup_Crick/raup-crick_otu_table_k__Archaea_100_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
dataRC = read.table(file=dataRC_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# try taking out african/australian sites
#map.bySite = map.bySite[!map.bySite$continent %in% c('Africa','Australia'),]
# match up the data.
samplesToUse = intersect(intersect(row.names(data),row.names(dataRC)),map.bySite$site_code)
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
dataRC.use = dataRC[match(samplesToUse,row.names(dataRC)),match(samplesToUse,names(dataRC))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
#mantel
data.dm = as.dist(data.use)
dataRC.dm = as.dist(dataRC.use)
plot(data.dm,dataRC.dm)
mantel(data.dm,dataRC.dm,method='spearman')
map_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_updated_noNN10.csv'
map = read.csv(file=map_fp,header=T,row.names=1,check.names=F)
hist(map$C_to_N)
map.bySite = ddply(map,.(site_code,continent),summarize,lnlive_mass=log(mean(live_mass)+1),
lntotal_mass=log(mean(total_mass)+1),MAP=mean(MAP),MAT=mean(MAT),
MAP_VAR=mean(MAP_VAR),TEMP_VAR=mean(TEMP_VAR),lnsoil_pctN=log(mean(soil_pctN,na.rm=T)+1),
lnsoil_ppmP=log(mean(soil_ppmP,na.rm=T)+1),soil_pH=mean(soil_pH,na.rm=T),lnPlant_Rich=log(mean(rich,na.rm=T)+1),
PercentSand=mean(PercentSand,na.rm=T),cult=mean(Cult,na.rm=T),grazed=mean(RecentGz,na.rm=T),
lnCtoN=log(mean(C_to_N,na.rm=T)+1))
map.bySite
hist(map.bySite$lnCtoN)
write.csv(map.bySite,'/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_updated_noNN10_bySite.csv',
row.names=F)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
names(map.bySite.use)
var = names(map.bySite.use)[16]
hist(map.bySite.use[,var],main=var)
var.dm = vegdist(decostand(map.bySite.use[,var],method='standardize'),method='euclidean',na.rm=T)
mantel(var.dm,data.use.dm,method="spearman",na.rm=T,permutations=9999)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Archaea_100_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
names(map.bySite.use)
var = names(map.bySite.use)[16]
hist(map.bySite.use[,var],main=var)
#var.dm = vegdist(map.bySite.use[,var],method='euclidean',na.rm=T)
var.dm = vegdist(decostand(map.bySite.use[,var],method='standardize'),method='euclidean',na.rm=T)
mantel(var.dm,data.use.dm,method="spearman",na.rm=T,permutations=9999)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_unite75_wTax_485_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
names(map.bySite.use)
var = names(map.bySite.use)[16]
hist(map.bySite.use[,var],main=var)
#var.dm = vegdist(map.bySite.use[,var],method='euclidean',na.rm=T)
var.dm = vegdist(decostand(map.bySite.use[,var],method='standardize'),method='euclidean',na.rm=T)
mantel(var.dm,data.use.dm,method="spearman",na.rm=T,permutations=9999)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/hellinger_bray_curtis_max_cover_genus_matrix_controls_avg_by_site_code.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
names(map.bySite.use)
var = names(map.bySite.use)[16]
hist(map.bySite.use[,var],main=var)
#var.dm = vegdist(map.bySite.use[,var],method='euclidean',na.rm=T)
var.dm = vegdist(decostand(map.bySite.use[,var],method='standardize'),method='euclidean',na.rm=T)
mantel(var.dm,data.use.dm,method="spearman",na.rm=T,permutations=9999)
library(ecodist)
C2N.dm = egdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
livePlant.dm = vegdist(decostand(map.bySite.use$lnlive_mass,method='standardize'),method='euclidean',na.rm=T)
map.dm = vegdist(decostand(map.bySite.use$MAP,method='standardize'),method='euclidean',na.rm=T)
mat.dm = vegdist(decostand(map.bySite.use$MAT,method='standardize'),method='euclidean',na.rm=T)
soil_ph.dm = vegdist(decostand(map.bySite.use$soil_pH,method='standardize',na.rm=T),method='euclidean',na.rm=T)
pctN.dm = vegdist(decostand(map.bySite.use$lnsoil_pctN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
ppmP.dm = vegdist(decostand(map.bySite.use$lnsoil_ppmP,method='standardize',na.rm=T),method='euclidean',na.rm=T)
sand.dm = vegdist(decostand(map.bySite.use$PercentSand,method='standardize',na.rm=T),method='euclidean',na.rm=T)
C2N.dm = vegdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~mat.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~mat.dm+sand.dm,mrank=T)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_unite75_wTax_485_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
names(map.bySite.use)
var = names(map.bySite.use)[16]
hist(map.bySite.use[,var],main=var)
#var.dm = vegdist(map.bySite.use[,var],method='euclidean',na.rm=T)
var.dm = vegdist(decostand(map.bySite.use[,var],method='standardize'),method='euclidean',na.rm=T)
mantel(var.dm,data.use.dm,method="spearman",na.rm=T,permutations=9999)
livePlant.dm = vegdist(decostand(map.bySite.use$lnlive_mass,method='standardize'),method='euclidean',na.rm=T)
map.dm = vegdist(decostand(map.bySite.use$MAP,method='standardize'),method='euclidean',na.rm=T)
mat.dm = vegdist(decostand(map.bySite.use$MAT,method='standardize'),method='euclidean',na.rm=T)
soil_ph.dm = vegdist(decostand(map.bySite.use$soil_pH,method='standardize',na.rm=T),method='euclidean',na.rm=T)
pctN.dm = vegdist(decostand(map.bySite.use$lnsoil_pctN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
ppmP.dm = vegdist(decostand(map.bySite.use$lnsoil_ppmP,method='standardize',na.rm=T),method='euclidean',na.rm=T)
sand.dm = vegdist(decostand(map.bySite.use$PercentSand,method='standardize',na.rm=T),method='euclidean',na.rm=T)
C2N.dm = vegdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+ppmP.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+C2N.dm,mrank=T)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Archaea_100_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
names(map.bySite.use)
var = names(map.bySite.use)[16]
hist(map.bySite.use[,var],main=var)
livePlant.dm = vegdist(decostand(map.bySite.use$lnlive_mass,method='standardize'),method='euclidean',na.rm=T)
map.dm = vegdist(decostand(map.bySite.use$MAP,method='standardize'),method='euclidean',na.rm=T)
mat.dm = vegdist(decostand(map.bySite.use$MAT,method='standardize'),method='euclidean',na.rm=T)
soil_ph.dm = vegdist(decostand(map.bySite.use$soil_pH,method='standardize',na.rm=T),method='euclidean',na.rm=T)
pctN.dm = vegdist(decostand(map.bySite.use$lnsoil_pctN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
ppmP.dm = vegdist(decostand(map.bySite.use$lnsoil_ppmP,method='standardize',na.rm=T),method='euclidean',na.rm=T)
sand.dm = vegdist(decostand(map.bySite.use$PercentSand,method='standardize',na.rm=T),method='euclidean',na.rm=T)
C2N.dm = vegdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+pctN.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+pctN.dm+C2N.dm,mrank=T)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
names(map.bySite.use)
var = names(map.bySite.use)[16]
livePlant.dm = vegdist(decostand(map.bySite.use$lnlive_mass,method='standardize'),method='euclidean',na.rm=T)
map.dm = vegdist(decostand(map.bySite.use$MAP,method='standardize'),method='euclidean',na.rm=T)
mat.dm = vegdist(decostand(map.bySite.use$MAT,method='standardize'),method='euclidean',na.rm=T)
soil_ph.dm = vegdist(decostand(map.bySite.use$soil_pH,method='standardize',na.rm=T),method='euclidean',na.rm=T)
pctN.dm = vegdist(decostand(map.bySite.use$lnsoil_pctN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
ppmP.dm = vegdist(decostand(map.bySite.use$lnsoil_ppmP,method='standardize',na.rm=T),method='euclidean',na.rm=T)
sand.dm = vegdist(decostand(map.bySite.use$PercentSand,method='standardize',na.rm=T),method='euclidean',na.rm=T)
C2N.dm = vegdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
#plant
MRM(formula=data.use.dm~mat.dm+sand.dm,mrank=T)
MRM(formula=data.use.dm~livePlant.dm+map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+pctN.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+ppmP.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+sand.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+C2N.dm,mrank=T)
dataP_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/hellinger_bray_curtis_max_cover_genus_matrix_controls_avg_by_site_code.txt'
dataP = read.table(file=dataP_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# get map in same order as dm
samplesToUse = intersect(names(data.use),names(dataP))
dataP.use = dataP[match(samplesToUse,row.names(dataP)),match(samplesToUse,names(dataP))]
# make cmty dm
dataP.use.dm = as.dist(dataP.use)
# run MRM
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+C2N.dm+dataP.use.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+dataP.use.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+sand.dm+dataP.use.dm,mrank=T)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_unite75_wTax_485_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
map_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/metadata_controls_updated_noNN10.csv'
map = read.csv(file=map_fp,header=T,row.names=1,check.names=F)
map.bySite = ddply(map,.(site_code,continent),summarize,lnlive_mass=log(mean(live_mass)+1),
lntotal_mass=log(mean(total_mass)+1),MAP=mean(MAP),MAT=mean(MAT),
MAP_VAR=mean(MAP_VAR),TEMP_VAR=mean(TEMP_VAR),lnsoil_pctN=log(mean(soil_pctN,na.rm=T)+1),
lnsoil_ppmP=log(mean(soil_ppmP,na.rm=T)+1),soil_pH=mean(soil_pH,na.rm=T),lnPlant_Rich=log(mean(rich,na.rm=T)+1),
PercentSand=mean(PercentSand,na.rm=T),cult=mean(Cult,na.rm=T),grazed=mean(RecentGz,na.rm=T),
lnCtoN=log(mean(C_to_N,na.rm=T)+1))
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
livePlant.dm = vegdist(decostand(map.bySite.use$lnlive_mass,method='standardize'),method='euclidean',na.rm=T)
map.dm = vegdist(decostand(map.bySite.use$MAP,method='standardize'),method='euclidean',na.rm=T)
mat.dm = vegdist(decostand(map.bySite.use$MAT,method='standardize'),method='euclidean',na.rm=T)
soil_ph.dm = vegdist(decostand(map.bySite.use$soil_pH,method='standardize',na.rm=T),method='euclidean',na.rm=T)
pctN.dm = vegdist(decostand(map.bySite.use$lnsoil_pctN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
ppmP.dm = vegdist(decostand(map.bySite.use$lnsoil_ppmP,method='standardize',na.rm=T),method='euclidean',na.rm=T)
sand.dm = vegdist(decostand(map.bySite.use$PercentSand,method='standardize',na.rm=T),method='euclidean',na.rm=T)
C2N.dm = vegdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
dataP_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/hellinger_bray_curtis_max_cover_genus_matrix_controls_avg_by_site_code.txt'
dataP = read.table(file=dataP_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# get map in same order as dm
samplesToUse = intersect(names(data.use),names(dataP))
dataP.use = dataP[match(samplesToUse,row.names(dataP)),match(samplesToUse,names(dataP))]
# make cmty dm
dataP.use.dm = as.dist(dataP.use)
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+C2N.dm+dataP.use.dm,mrank=T)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Bacteria_18000_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
# make the environ dm
dataP_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/hellinger_bray_curtis_max_cover_genus_matrix_controls_avg_by_site_code.txt'
dataP = read.table(file=dataP_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# get map in same order as dm
samplesToUse = intersect(names(data.use),names(dataP))
dataP.use = dataP[match(samplesToUse,row.names(dataP)),match(samplesToUse,names(dataP))]
# make cmty dm
dataP.use.dm = as.dist(dataP.use)
# run MRM
#bact
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+sand.dm+dataP.use.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+C2N.dm+dataP.use.dm,mrank=T)
MRM(formula=data.use.dm~map.dm+mat.dm+soil_ph.dm+C2N.dm,mrank=T)
data_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/beta_div/sqrt_bray_curtis_otu_table_k__Archaea_100_controls_avgSiteCode.txt'
data = read.table(file=data_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# remove sites with na for pH
map.bySite = map.bySite[!is.na(map.bySite$soil_pH),]
# get map in same order as dm
samplesToUse = intersect(map.bySite$site_code,row.names(data))
data.use = data[match(samplesToUse,row.names(data)),match(samplesToUse,names(data))]
map.bySite.use = map.bySite[match(samplesToUse,map.bySite$site_code),]
# make cmty dm
data.use.dm = as.dist(data.use)
MRM(formula=data.use.dm~mat.dm+sand.dm,mrank=T)
dataP_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/hellinger_bray_curtis_max_cover_genus_matrix_controls_avg_by_site_code.txt'
dataP = read.table(file=dataP_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# get map in same order as dm
samplesToUse = intersect(names(data.use),names(dataP))
dataP.use = dataP[match(samplesToUse,row.names(dataP)),match(samplesToUse,names(dataP))]
# make cmty dm
dataP.use.dm = as.dist(dataP.use)
# run MRM
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+pctN.dm+C2N.dm,mrank=T)
livePlant.dm = vegdist(decostand(map.bySite.use$lnlive_mass,method='standardize'),method='euclidean',na.rm=T)
map.dm = vegdist(decostand(map.bySite.use$MAP,method='standardize'),method='euclidean',na.rm=T)
mat.dm = vegdist(decostand(map.bySite.use$MAT,method='standardize'),method='euclidean',na.rm=T)
soil_ph.dm = vegdist(decostand(map.bySite.use$soil_pH,method='standardize',na.rm=T),method='euclidean',na.rm=T)
pctN.dm = vegdist(decostand(map.bySite.use$lnsoil_pctN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
ppmP.dm = vegdist(decostand(map.bySite.use$lnsoil_ppmP,method='standardize',na.rm=T),method='euclidean',na.rm=T)
sand.dm = vegdist(decostand(map.bySite.use$PercentSand,method='standardize',na.rm=T),method='euclidean',na.rm=T)
C2N.dm = vegdist(decostand(map.bySite.use$lnCtoN,method='standardize',na.rm=T),method='euclidean',na.rm=T)
dataP_fp = '/Users/leffj/Dropbox/NutNet/NutNet_microbe_diversity/veg_data/hellinger_bray_curtis_max_cover_genus_matrix_controls_avg_by_site_code.txt'
dataP = read.table(file=dataP_fp,header=T,sep='\t',row.names=1,check.names=F,comment.char='')
# get map in same order as dm
samplesToUse = intersect(names(data.use),names(dataP))
dataP.use = dataP[match(samplesToUse,row.names(dataP)),match(samplesToUse,names(dataP))]
# make cmty dm
dataP.use.dm = as.dist(dataP.use)
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+pctN.dm+C2N.dm,mrank=T)
MRM(formula=data.use.dm~mat.dm+soil_ph.dm+pctN.dm+C2N.dm+dataP.use.dm,mrank=T)
